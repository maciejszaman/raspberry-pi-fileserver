{"version":3,"sources":["../src/components/MessageBar/useMessageBarReflow.ts"],"sourcesContent":["import * as React from 'react';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\n\nexport function useMessageBarReflow(enabled: boolean = false) {\n  const { targetDocument } = useFluent();\n  const prevInlineSizeRef = React.useRef(-1);\n  const messageBarRef = React.useRef<HTMLElement | null>(null);\n\n  const [reflowing, setReflowing] = React.useState(false);\n\n  // This layout effect 'sanity checks' what observers have done\n  // since DOM has not been flushed when observers run\n  useIsomorphicLayoutEffect(() => {\n    if (!messageBarRef.current) {\n      return;\n    }\n\n    setReflowing(prevReflowing => {\n      if (!prevReflowing && messageBarRef.current && isReflowing(messageBarRef.current)) {\n        return true;\n      }\n\n      return prevReflowing;\n    });\n  }, [reflowing]);\n\n  const handleResize: ResizeObserverCallback = React.useCallback(() => {\n    if (!messageBarRef.current) {\n      return;\n    }\n\n    const inlineSize = messageBarRef.current.getBoundingClientRect().width;\n    const scrollWidth = messageBarRef.current.scrollWidth;\n\n    const expanding = prevInlineSizeRef.current < inlineSize;\n    const overflowing = inlineSize < scrollWidth;\n\n    setReflowing(!expanding || overflowing);\n  }, []);\n\n  const handleIntersection: IntersectionObserverCallback = React.useCallback(entries => {\n    if (entries[0].intersectionRatio < 1) {\n      setReflowing(true);\n    }\n  }, []);\n\n  const ref = React.useMemo(() => {\n    let resizeObserver: ResizeObserver | null = null;\n    let intersectionObserer: IntersectionObserver | null = null;\n\n    return (el: HTMLElement | null) => {\n      if (!enabled || !el || !targetDocument?.defaultView) {\n        resizeObserver?.disconnect();\n        intersectionObserer?.disconnect();\n        return;\n      }\n\n      messageBarRef.current = el;\n\n      const win = targetDocument.defaultView;\n      resizeObserver = new win.ResizeObserver(handleResize);\n      intersectionObserer = new win.IntersectionObserver(handleIntersection, { threshold: 1 });\n\n      intersectionObserer.observe(el);\n      resizeObserver.observe(el, { box: 'border-box' });\n    };\n  }, [handleResize, handleIntersection, enabled, targetDocument]);\n\n  return { ref, reflowing };\n}\n\nconst isReflowing = (el: HTMLElement) => {\n  return el.scrollWidth > el.offsetWidth || !isFullyInViewport(el);\n};\n\nconst isFullyInViewport = (el: HTMLElement) => {\n  const rect = el.getBoundingClientRect();\n  const doc = el.ownerDocument;\n  const win = doc.defaultView;\n\n  if (!win) {\n    return true;\n  }\n\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <= (win.innerHeight || doc.documentElement.clientHeight) &&\n    rect.right <= (win.innerWidth || doc.documentElement.clientWidth)\n  );\n};\n"],"names":["React","useFluent_unstable","useFluent","useIsomorphicLayoutEffect","useMessageBarReflow","enabled","targetDocument","prevInlineSizeRef","useRef","messageBarRef","reflowing","setReflowing","useState","current","prevReflowing","isReflowing","handleResize","useCallback","inlineSize","getBoundingClientRect","width","scrollWidth","expanding","overflowing","handleIntersection","entries","intersectionRatio","ref","useMemo","resizeObserver","intersectionObserer","el","defaultView","disconnect","win","ResizeObserver","IntersectionObserver","threshold","observe","box","offsetWidth","isFullyInViewport","rect","doc","ownerDocument","top","left","bottom","innerHeight","documentElement","clientHeight","right","innerWidth","clientWidth"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,sBAAsBC,SAAS,QAAQ,kCAAkC;AAClF,SAASC,yBAAyB,QAAQ,4BAA4B;AAEtE,OAAO,SAASC,oBAAoBC,UAAmB,KAAK;IAC1D,MAAM,EAAEC,cAAc,EAAE,GAAGJ;IAC3B,MAAMK,oBAAoBP,MAAMQ,MAAM,CAAC,CAAC;IACxC,MAAMC,gBAAgBT,MAAMQ,MAAM,CAAqB;IAEvD,MAAM,CAACE,WAAWC,aAAa,GAAGX,MAAMY,QAAQ,CAAC;IAEjD,8DAA8D;IAC9D,oDAAoD;IACpDT,0BAA0B;QACxB,IAAI,CAACM,cAAcI,OAAO,EAAE;YAC1B;QACF;QAEAF,aAAaG,CAAAA;YACX,IAAI,CAACA,iBAAiBL,cAAcI,OAAO,IAAIE,YAAYN,cAAcI,OAAO,GAAG;gBACjF,OAAO;YACT;YAEA,OAAOC;QACT;IACF,GAAG;QAACJ;KAAU;IAEd,MAAMM,eAAuChB,MAAMiB,WAAW,CAAC;QAC7D,IAAI,CAACR,cAAcI,OAAO,EAAE;YAC1B;QACF;QAEA,MAAMK,aAAaT,cAAcI,OAAO,CAACM,qBAAqB,GAAGC,KAAK;QACtE,MAAMC,cAAcZ,cAAcI,OAAO,CAACQ,WAAW;QAErD,MAAMC,YAAYf,kBAAkBM,OAAO,GAAGK;QAC9C,MAAMK,cAAcL,aAAaG;QAEjCV,aAAa,CAACW,aAAaC;IAC7B,GAAG,EAAE;IAEL,MAAMC,qBAAmDxB,MAAMiB,WAAW,CAACQ,CAAAA;QACzE,IAAIA,OAAO,CAAC,EAAE,CAACC,iBAAiB,GAAG,GAAG;YACpCf,aAAa;QACf;IACF,GAAG,EAAE;IAEL,MAAMgB,MAAM3B,MAAM4B,OAAO,CAAC;QACxB,IAAIC,iBAAwC;QAC5C,IAAIC,sBAAmD;QAEvD,OAAO,CAACC;YACN,IAAI,CAAC1B,WAAW,CAAC0B,MAAM,EAACzB,2BAAAA,qCAAAA,eAAgB0B,WAAW,GAAE;gBACnDH,2BAAAA,qCAAAA,eAAgBI,UAAU;gBAC1BH,gCAAAA,0CAAAA,oBAAqBG,UAAU;gBAC/B;YACF;YAEAxB,cAAcI,OAAO,GAAGkB;YAExB,MAAMG,MAAM5B,eAAe0B,WAAW;YACtCH,iBAAiB,IAAIK,IAAIC,cAAc,CAACnB;YACxCc,sBAAsB,IAAII,IAAIE,oBAAoB,CAACZ,oBAAoB;gBAAEa,WAAW;YAAE;YAEtFP,oBAAoBQ,OAAO,CAACP;YAC5BF,eAAeS,OAAO,CAACP,IAAI;gBAAEQ,KAAK;YAAa;QACjD;IACF,GAAG;QAACvB;QAAcQ;QAAoBnB;QAASC;KAAe;IAE9D,OAAO;QAAEqB;QAAKjB;IAAU;AAC1B;AAEA,MAAMK,cAAc,CAACgB;IACnB,OAAOA,GAAGV,WAAW,GAAGU,GAAGS,WAAW,IAAI,CAACC,kBAAkBV;AAC/D;AAEA,MAAMU,oBAAoB,CAACV;IACzB,MAAMW,OAAOX,GAAGZ,qBAAqB;IACrC,MAAMwB,MAAMZ,GAAGa,aAAa;IAC5B,MAAMV,MAAMS,IAAIX,WAAW;IAE3B,IAAI,CAACE,KAAK;QACR,OAAO;IACT;IAEA,OACEQ,KAAKG,GAAG,IAAI,KACZH,KAAKI,IAAI,IAAI,KACbJ,KAAKK,MAAM,IAAKb,CAAAA,IAAIc,WAAW,IAAIL,IAAIM,eAAe,CAACC,YAAY,AAAD,KAClER,KAAKS,KAAK,IAAKjB,CAAAA,IAAIkB,UAAU,IAAIT,IAAIM,eAAe,CAACI,WAAW,AAAD;AAEnE"}